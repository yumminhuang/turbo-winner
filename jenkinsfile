pipeline {
    agent any

    parameters {
        string(
            name: 'BRANCH',
            defaultValue: 'master',
            trim: true,
            description: 'Repo branch to checkout')

        string(
            name: 'BASE_IMAGE',
            defaultValue: '',
            trim: true,
            description: 'Base Docker image. Leave it blank to use the default value in build.properties.')
    }

    stages {
        stage('Build') {
            options {
                timeout(time: 3, unit: 'SECONDS')
            }
            steps {
                script {
                    def props = readProperties file: 'build.properties', defaults: [PARENT: 'centos']
                    base_image = "${BASE_IMAGE}" == "" ? props['PARENT'] : "${BASE_IMAGE}"
                }
                try {
                    echo "Develop branch: ${params.BRANCH}"
                    sleep 5
                    echo "Build Docker from: ${base_image}"
                }
                catch(exc) {
                    echo "Failed to build from: ${base_image}"
                    unstable('Build failure')
                }

            }
        }

        stage('Deploy') {
            steps {
                echo "Develop branch: ${params.BRANCH}"
                echo "Build Docker from: ${base_image}"
            }
        }
    }
}

def parent_image_for_branches = [
    master: 'alpine',
    develop: 'ubuntu'
]


pipeline {
    agent any

    parameters {
        string(
            name: 'BRANCH',
            defaultValue: 'master',
            trim: true,
            description: 'Repo branch to checkout')

        string(
            name: 'BASE_IMAGE',
            defaultValue: '',
            trim: true,
            description: 'Base Docker image. Leave it blank to use the default value.')
    }

    stages {
        stage('Build') {
            steps {
                script {
                    base_image = "${BASE_IMAGE}" == "" ? parent_image_for_branches[BRANCH] : "${BASE_IMAGE}"
                }

                echo "Develop branch: ${params.BRANCH}"
                echo "Build Docker from: ${base_image}"
            }
        }

        stage('Deploy') {
            steps {
                echo "Develop branch: ${params.BRANCH}"
                echo "Build Docker from: ${base_image}"
            }
        }
    }
}
